

dataPath <- function(inputAnalDiff){

  dataPath = c()
  cpt = 1

  for( i in 1: inputAnalDiff$nb_facteur) {


    for(j in 1: length(inputAnalDiff[[paste0("file", i)]][[1]])) {
      dataPath[[cpt]] = inputAnalDiff[[paste0("file",i)]][[j, 'datapath']]
      cpt = cpt+1
    }
  }
  return(dataPath)
}



# Fonction qui regroupe dans un tableau tous les fichiers charge, 1 colonne = 1 fichier
tabData<-function(input){

  if( input$exemple == 0 ) {
    fileList = dataPath(input)
    nbFile   = length(fileList)

    table = read.table(file = fileList[[1]], sep = "\t", header = FALSE)

    for( i in 2:nbFile) {
      tab = read.table(file = fileList[[i]], sep="\t", header=FALSE )
      if(nrow(tab) != nrow(table)){
        shinyalert("Oops!", "The number of lines is differents ", type = "error")
        return(NULL)
      }
      table = cbind(table, tab[2])
    }
    colnames(table) = c("Transcrit", getReplicaNames(input))}
  else { table=getDataTest() }

  return(table)
}
tabCheck<-function(input){



  if(input$exemple == 0) { # On ne travaille pas sur les donnÃ©es test

    fileList = dataPath(input)
    nbFile   = length(fileList)

    if(nbFile == 0) {
      shinyalert("Oops!", "No File", type = "error")
      return(NULL)
    }

    for( i in 1: input$nb_facteur) {
      if(length(input[[paste0("file",i)]][[1]]) == 0) {

        shinyalert("Oops!", paste0("No File in condition", i), type = "error")
        return(NULL)
      }
    }

    table = read.table(file = fileList[[1]],sep = "\t",header = FALSE)

    for( i in 2:nbFile) {
      tab = read.table(file = fileList[[i]],sep = "\t",header = FALSE )

      if(nrow(tab) != nrow(table)) {

        shinyalert("Oops!", "The number of lines is differents ", type = "error")
        return(NULL)
      }
      else {


      }
    }
  }

  return(1)
}

getDataTest <- function(){

  names   = c('transcrit1','transcrit2','transcrit3','transcrit4','transcrit5','transcrit6','transcrit7','transcrit8','transcrit9','transcrit10','transcrit11','transcrit12','transcrit13','transcrit14','transcrit15','transcrit16','transcrit17','transcrit18','transcrit19','transcrit20','transcrit21','transcrit22','transcrit23','transcrit24','transcrit25','transcrit26','transcrit27','transcrit28','transcrit29','transcrit30','transcrit31','transcrit32','transcrit33','transcrit34','transcrit35','transcrit36','transcrit37','transcrit38','transcrit39','transcrit40','transcrit41','transcrit42','transcrit43','transcrit44','transcrit45','transcrit46','transcrit47','transcrit48','transcrit49','transcrit50','transcrit51','transcrit52','transcrit53','transcrit54','transcrit55','transcrit56','transcrit57','transcrit58','transcrit59','transcrit60','transcrit61','transcrit62','transcrit63','transcrit64','transcrit65','transcrit66','transcrit67','transcrit68','transcrit69','transcrit70','transcrit71','transcrit72','transcrit73','transcrit74','transcrit75','transcrit76','transcrit77','transcrit78','transcrit79','transcrit80','transcrit81','transcrit82','transcrit83','transcrit84','transcrit85','transcrit86','transcrit87','transcrit88','transcrit89','transcrit90','transcrit91','transcrit92','transcrit93','transcrit94','transcrit95','transcrit96','transcrit97','transcrit98','transcrit99','transcrit100','transcrit101','transcrit102','transcrit103','transcrit104','transcrit105','transcrit106','transcrit107','transcrit108','transcrit109','transcrit110','transcrit111','transcrit112','transcrit113','transcrit114','transcrit115','transcrit116','transcrit117','transcrit118','transcrit119','transcrit120','transcrit121','transcrit122','transcrit123','transcrit124','transcrit125','transcrit126','transcrit127','transcrit128','transcrit129','transcrit130','transcrit131','transcrit132','transcrit133','transcrit134','transcrit135','transcrit136','transcrit137','transcrit138','transcrit139','transcrit140','transcrit141','transcrit142','transcrit143','transcrit144','transcrit145','transcrit146','transcrit147','transcrit148','transcrit149','transcrit150','transcrit151','transcrit152','transcrit153','transcrit154','transcrit155','transcrit156','transcrit157','transcrit158','transcrit159','transcrit160','transcrit161','transcrit162','transcrit163','transcrit164','transcrit165','transcrit166','transcrit167','transcrit168','transcrit169','transcrit170','transcrit171','transcrit172','transcrit173','transcrit174','transcrit175','transcrit176','transcrit177','transcrit178','transcrit179','transcrit180','transcrit181','transcrit182','transcrit183','transcrit184','transcrit185','transcrit186','transcrit187','transcrit188','transcrit189','transcrit190','transcrit191','transcrit192','transcrit193','transcrit194','transcrit195','transcrit196','transcrit197','transcrit198','transcrit199','transcrit200','transcrit201','transcrit202','transcrit203','transcrit204','transcrit205','transcrit206','transcrit207','transcrit208','transcrit209','transcrit210','transcrit211','transcrit212','transcrit213','transcrit214','transcrit215','transcrit216','transcrit217','transcrit218','transcrit219','transcrit220','transcrit221','transcrit222','transcrit223','transcrit224','transcrit225','transcrit226','transcrit227','transcrit228','transcrit229','transcrit230','transcrit231','transcrit232','transcrit233','transcrit234','transcrit235','transcrit236','transcrit237','transcrit238','transcrit239','transcrit240','transcrit241','transcrit242','transcrit243','transcrit244','transcrit245','transcrit246','transcrit247','transcrit248','transcrit249','transcrit250','transcrit251','transcrit252','transcrit253','transcrit254','transcrit255','transcrit256','transcrit257','transcrit258','transcrit259','transcrit260','transcrit261','transcrit262','transcrit263','transcrit264','transcrit265','transcrit266','transcrit267','transcrit268','transcrit269','transcrit270','transcrit271','transcrit272','transcrit273','transcrit274','transcrit275','transcrit276','transcrit277','transcrit278','transcrit279','transcrit280','transcrit281','transcrit282','transcrit283','transcrit284','transcrit285','transcrit286','transcrit287','transcrit288','transcrit289','transcrit290','transcrit291','transcrit292','transcrit293','transcrit294','transcrit295','transcrit296','transcrit297','transcrit298','transcrit299','transcrit300','transcrit301','transcrit302','transcrit303','transcrit304','transcrit305','transcrit306','transcrit307','transcrit308','transcrit309','transcrit310','transcrit311','transcrit312','transcrit313','transcrit314','transcrit315','transcrit316','transcrit317','transcrit318','transcrit319','transcrit320','transcrit321','transcrit322','transcrit323','transcrit324','transcrit325','transcrit326','transcrit327','transcrit328','transcrit329','transcrit330','transcrit331','transcrit332','transcrit333','transcrit334','transcrit335','transcrit336','transcrit337','transcrit338','transcrit339','transcrit340','transcrit341','transcrit342','transcrit343','transcrit344','transcrit345','transcrit346','transcrit347','transcrit348','transcrit349','transcrit350','transcrit351','transcrit352','transcrit353','transcrit354','transcrit355','transcrit356','transcrit357','transcrit358','transcrit359','transcrit360','transcrit361','transcrit362','transcrit363','transcrit364','transcrit365','transcrit366','transcrit367','transcrit368','transcrit369','transcrit370','transcrit371','transcrit372','transcrit373','transcrit374','transcrit375','transcrit376','transcrit377','transcrit378','transcrit379','transcrit380','transcrit381','transcrit382','transcrit383','transcrit384','transcrit385','transcrit386','transcrit387','transcrit388','transcrit389','transcrit390','transcrit391','transcrit392','transcrit393','transcrit394','transcrit395','transcrit396','transcrit397','transcrit398','transcrit399','transcrit400','transcrit401','transcrit402','transcrit403','transcrit404','transcrit405','transcrit406','transcrit407','transcrit408','transcrit409','transcrit410','transcrit411','transcrit412','transcrit413','transcrit414','transcrit415','transcrit416','transcrit417','transcrit418','transcrit419','transcrit420','transcrit421','transcrit422','transcrit423','transcrit424','transcrit425','transcrit426','transcrit427','transcrit428','transcrit429','transcrit430','transcrit431','transcrit432','transcrit433','transcrit434','transcrit435','transcrit436','transcrit437','transcrit438','transcrit439','transcrit440','transcrit441','transcrit442','transcrit443','transcrit444','transcrit445','transcrit446','transcrit447','transcrit448','transcrit449','transcrit450','transcrit451','transcrit452','transcrit453','transcrit454','transcrit455','transcrit456','transcrit457','transcrit458','transcrit459','transcrit460','transcrit461','transcrit462','transcrit463','transcrit464','transcrit465','transcrit466','transcrit467','transcrit468','transcrit469','transcrit470','transcrit471','transcrit472','transcrit473','transcrit474','transcrit475','transcrit476','transcrit477','transcrit478','transcrit479','transcrit480','transcrit481','transcrit482','transcrit483','transcrit484','transcrit485','transcrit486','transcrit487','transcrit488','transcrit489','transcrit490','transcrit491','transcrit492','transcrit493','transcrit494','transcrit495','transcrit496','transcrit497','transcrit498','transcrit499','transcrit500','transcrit501','transcrit502','transcrit503','transcrit504','transcrit505','transcrit506','transcrit507','transcrit508','transcrit509','transcrit510','transcrit511','transcrit512','transcrit513','transcrit514','transcrit515','transcrit516','transcrit517','transcrit518','transcrit519','transcrit520','transcrit521','transcrit522','transcrit523','transcrit524','transcrit525','transcrit526','transcrit527','transcrit528','transcrit529','transcrit530','transcrit531','transcrit532','transcrit533','transcrit534','transcrit535','transcrit536','transcrit537','transcrit538','transcrit539','transcrit540','transcrit541','transcrit542','transcrit543','transcrit544','transcrit545','transcrit546','transcrit547','transcrit548','transcrit549','transcrit550','transcrit551','transcrit552','transcrit553','transcrit554','transcrit555','transcrit556','transcrit557','transcrit558','transcrit559','transcrit560','transcrit561','transcrit562','transcrit563','transcrit564','transcrit565','transcrit566','transcrit567','transcrit568','transcrit569','transcrit570','transcrit571','transcrit572','transcrit573','transcrit574','transcrit575','transcrit576','transcrit577','transcrit578','transcrit579','transcrit580','transcrit581','transcrit582','transcrit583','transcrit584','transcrit585','transcrit586','transcrit587','transcrit588','transcrit589','transcrit590','transcrit591','transcrit592','transcrit593','transcrit594','transcrit595','transcrit596','transcrit597','transcrit598','transcrit599','transcrit600','transcrit601','transcrit602','transcrit603','transcrit604','transcrit605','transcrit606','transcrit607','transcrit608','transcrit609','transcrit610','transcrit611','transcrit612','transcrit613','transcrit614','transcrit615','transcrit616','transcrit617','transcrit618','transcrit619','transcrit620','transcrit621','transcrit622','transcrit623','transcrit624','transcrit625','transcrit626','transcrit627','transcrit628','transcrit629','transcrit630','transcrit631','transcrit632','transcrit633','transcrit634','transcrit635','transcrit636','transcrit637','transcrit638','transcrit639','transcrit640','transcrit641','transcrit642','transcrit643','transcrit644','transcrit645','transcrit646','transcrit647','transcrit648','transcrit649','transcrit650','transcrit651','transcrit652','transcrit653','transcrit654','transcrit655','transcrit656','transcrit657','transcrit658','transcrit659','transcrit660','transcrit661','transcrit662','transcrit663','transcrit664','transcrit665','transcrit666','transcrit667','transcrit668','transcrit669','transcrit670','transcrit671','transcrit672','transcrit673','transcrit674','transcrit675','transcrit676','transcrit677','transcrit678','transcrit679','transcrit680','transcrit681','transcrit682','transcrit683','transcrit684','transcrit685','transcrit686','transcrit687','transcrit688','transcrit689','transcrit690','transcrit691','transcrit692','transcrit693','transcrit694','transcrit695','transcrit696','transcrit697','transcrit698','transcrit699','transcrit700','transcrit701','transcrit702','transcrit703','transcrit704','transcrit705','transcrit706','transcrit707','transcrit708','transcrit709','transcrit710','transcrit711','transcrit712','transcrit713','transcrit714','transcrit715','transcrit716','transcrit717','transcrit718','transcrit719','transcrit720','transcrit721','transcrit722','transcrit723','transcrit724','transcrit725','transcrit726','transcrit727','transcrit728','transcrit729','transcrit730','transcrit731','transcrit732','transcrit733','transcrit734','transcrit735','transcrit736','transcrit737','transcrit738','transcrit739','transcrit740','transcrit741','transcrit742','transcrit743','transcrit744','transcrit745','transcrit746','transcrit747','transcrit748','transcrit749','transcrit750','transcrit751','transcrit752','transcrit753','transcrit754','transcrit755','transcrit756','transcrit757','transcrit758','transcrit759','transcrit760','transcrit761','transcrit762','transcrit763','transcrit764','transcrit765','transcrit766','transcrit767','transcrit768','transcrit769','transcrit770','transcrit771','transcrit772','transcrit773','transcrit774','transcrit775','transcrit776','transcrit777','transcrit778','transcrit779','transcrit780','transcrit781','transcrit782','transcrit783','transcrit784','transcrit785','transcrit786','transcrit787','transcrit788','transcrit789','transcrit790','transcrit791','transcrit792','transcrit793','transcrit794','transcrit795','transcrit796','transcrit797','transcrit798','transcrit799','transcrit800','transcrit801','transcrit802','transcrit803','transcrit804','transcrit805','transcrit806','transcrit807','transcrit808','transcrit809','transcrit810','transcrit811','transcrit812','transcrit813','transcrit814','transcrit815','transcrit816','transcrit817','transcrit818','transcrit819','transcrit820','transcrit821','transcrit822','transcrit823','transcrit824','transcrit825','transcrit826','transcrit827','transcrit828','transcrit829','transcrit830','transcrit831','transcrit832','transcrit833','transcrit834','transcrit835','transcrit836','transcrit837','transcrit838','transcrit839','transcrit840','transcrit841','transcrit842','transcrit843','transcrit844','transcrit845','transcrit846','transcrit847','transcrit848','transcrit849','transcrit850','transcrit851','transcrit852','transcrit853','transcrit854','transcrit855','transcrit856','transcrit857','transcrit858','transcrit859','transcrit860','transcrit861','transcrit862','transcrit863','transcrit864','transcrit865','transcrit866','transcrit867','transcrit868','transcrit869','transcrit870','transcrit871','transcrit872','transcrit873','transcrit874','transcrit875','transcrit876','transcrit877','transcrit878','transcrit879','transcrit880','transcrit881','transcrit882','transcrit883','transcrit884','transcrit885','transcrit886','transcrit887','transcrit888','transcrit889','transcrit890','transcrit891','transcrit892','transcrit893','transcrit894','transcrit895','transcrit896','transcrit897','transcrit898','transcrit899','transcrit900','transcrit901','transcrit902','transcrit903','transcrit904','transcrit905','transcrit906','transcrit907','transcrit908','transcrit909','transcrit910','transcrit911','transcrit912','transcrit913','transcrit914','transcrit915','transcrit916','transcrit917','transcrit918','transcrit919','transcrit920','transcrit921','transcrit922','transcrit923','transcrit924','transcrit925','transcrit926','transcrit927','transcrit928','transcrit929','transcrit930','transcrit931','transcrit932','transcrit933','transcrit934','transcrit935','transcrit936','transcrit937','transcrit938','transcrit939','transcrit940','transcrit941','transcrit942','transcrit943','transcrit944','transcrit945','transcrit946','transcrit947','transcrit948','transcrit949','transcrit950','transcrit951','transcrit952','transcrit953','transcrit954','transcrit955','transcrit956','transcrit957','transcrit958','transcrit959','transcrit960','transcrit961','transcrit962','transcrit963','transcrit964','transcrit965','transcrit966','transcrit967','transcrit968','transcrit969','transcrit970','transcrit971','transcrit972','transcrit973','transcrit974','transcrit975','transcrit976','transcrit977','transcrit978','transcrit979','transcrit980','transcrit981','transcrit982','transcrit983','transcrit984','transcrit985','transcrit986','transcrit987','transcrit988','transcrit989','transcrit990','transcrit991','transcrit992','transcrit993','transcrit994','transcrit995','transcrit996','transcrit997','transcrit998','transcrit999','transcrit1000')
  sample1 = c(0,0,13,7,0,9,43,13,0,11,3,15,3,0,0,9,18,0,0,4,0,5,0,1,0,13,19,35,0,6,0,2,0,0,3,14,5,1,298,0,10,0,22,4,7,0,3,0,12,31,66,45,0,0,6,0,8,0,251,0,0,0,1,1,0,0,0,0,12,1,120,0,10,1,0,5,0,10,35,8,8,0,5,2,0,0,0,6,17,3,22,0,42532,654,1,14,0,1,0,0,57363,0,747,3,31,0,0,191,198,108,19,41,379,4,322,4,961,17,75,1196,820,4,795,76,26,372,176,144,829,58,381,73,1039,94,5,40,19448,17,49,77,545,21,739,402,23,31,2,825,127,50,1315,1695,26,79,20,455,3359,237,134,359,38,54,173,158,70,368,252,12,31,431,238,834,80,31,1,665,368,0,608,34708,2000,1133,249,280,120,109,516,5909,1038,116,123,318,39,204,35,2053,75,57,133,256,411,1023,203,650,7,2,498,582,19,28,114,9,875,22,430,1531,314,945,1186,719,581,4,106,971,206,254,18,81,25,2715,406,1,531,30,328,3557,313,213,985,19,70,5287,394,4450,739,321,2768,144,210,31,212,16,69,960,424,0,9,22,46,553,81,20,372,187,57,1683,1122,296,141,4,12,1331,2284,77,2926,26,594,69,462,1830,490,417,90,54,35,46,477,92,555,23,3,14,461,215,50,496,50,372,1795,66,7183,229,67,675,550,26,223,535,1096,46,1,165,424,93,390,1,41,7,53,79,53,26,57,9,138,37,249,42,566,172,70,469,982,8,7,73,52,419,559,655,108,149,1788,44,28,272,17,426,810,449,5,92,97,95,772,313,7,480,23,83,453,30,1,220,16,350,493,249,0,164,126,427,267,33,10568,14,425,1163,385,1087,118,30,99,266,2,99,1190,9,8,115,683,221,2133,272,408,13449,46,10,3400,314,256,107,1301,503,106,86,347,134,102,136,4,1422,10,0,3,95,9,34,195,9,75,29,56,102,10,3,6,251,28,30,83,126,103,63,154,44,14,109,149,2,10,3036,51,15,1564,85,52,28,105776,2088,53,7241,7,14,1515,0,18,157,57,96,90,30,888,508,15,66,103,1415,188,1642,202,488,13,495,14,67,84,10,11,133,75,116,685,331,1054,3687,1302,232,6,156,352,401,189,39,171,194,140,112,16,392,17,77,59,841,963,72,620,237,49,1019,334,3523,712,1374,209,322,338,120,406,306,370,171,4,19,37,440,16,17,95,3,140,119,4,28,441,9479,169,871,5,0,107,123,34,17,62,0,2867,173,220,161,404,36,29,3,37,155,459,2,514,48,4,337,96,62,4565,5,59,9,73,548,1978,175,44,284,214,2,125,695,350,231,2,1510,18,27,41,82,461,374,10,2,81,1722,132,72,455,66,522,16,1224,68,143,198,318,553,10,1389,121,19,492,210,0,99,33,656,6,224,20,1682,39,11,43,200,62,212,2455,24,341,430,1071,49,169,2748,161,122,280,50,529,401,183,2316,96,31,133,266,152,141,677,1233,97,34,224,18,156,185,5,4872,1234,380,3,206,615,167,25,149,10,277,599,746,33,6,389,0,965,1686,683,53,19,126623,1173,464,150,424,401,46,10,221,224,4,52,8,524,1059,1451,96,144,147,133,92,99,25,716,15,166,77,0,175,81,206,13,75,207,114,2414,874,106,185,119,118,8,935,1,110,1581,3202,249,43,95,515,2663,306,1535,114,41,575,31,34,261,14,185,49,94,53,39,206,106,128,314,519,230,6965,214,85,44,10,121,34,174,193,47,77,135,22,15,15,531,15,338,255,11,632,70,86,2,93,93,2,7,171,71,71,158,105,27,223,67,43,31,1402,2,19669,37,12,159,15642,1174,151,433,270,28,348,9,88,378,19,86,1247,1025,20,247,127,361,68,5,642,312,15,30,78,74,103,77,155,86,29,193,22,518,16,7,66,111,15,4,61,28,90,22,68,449,269,221,699,75,138,302,31,832,9631,1054,117,34,119,56,14,290,165,296,962,206,18,16,229,94,1295,71,52,4,257,1,46,1279,78,1028,74,18,1089,30,43,64,188,81,58,29,2561,1153,198,399,312,50,1273,1023,611,130,129,131,33,35,30,451,2148,21,63,37,133,240,90,627,212,329,7,14,44,184,1199,121,316,48,320,3771,390,41,79,613,192,29,43,19,463,22,163,151,20,85646,371,233,84,44,8,289,85,82,331,5,550,169,174,2526,32,93,114,5,110,4340,727,16,2017,497,369,190,98,307,102,212,171,501,12,2664,8,17,63,138,4,61,102,185,58,13,62,165,8,108,5006,1120,206,302,491,226,536,96,152,74,1,69,18,16,215,837,12507,29,137)
  sample2 = c(0,0,13,3,0,3,10,3,1,4,6,18,5,0,0,3,33,0,0,0,0,0,0,3,3,8,3,24,2,15,0,1,0,0,6,34,3,0,156,0,20,0,25,1,39,0,1,0,6,17,24,28,0,0,5,0,4,0,78,0,0,0,1,0,0,0,0,0,3,0,75,0,20,0,0,4,0,20,19,20,18,0,2,7,0,0,0,1,8,1,5,0,43264,1757,1,9,0,14,0,0,46924,0,2080,0,10,0,0,171,95,67,2,15,160,27,350,3,395,15,49,1220,780,2,219,23,18,367,129,492,467,47,429,62,2053,55,0,41,6099,74,50,33,416,18,276,126,23,37,1,1079,175,24,487,3656,18,52,4,413,2358,343,29,72,45,105,169,129,9,354,129,18,7,368,180,440,66,38,1,854,1159,0,472,9043,2462,1223,169,394,97,94,55,20991,529,23,30,172,31,160,45,947,59,63,55,240,438,555,964,866,0,2,289,358,23,37,29,32,492,1,213,769,860,1119,300,605,109,29,87,220,111,199,14,54,25,1052,291,6,486,4,338,3433,404,176,479,10,44,6942,118,2445,1408,625,2562,74,142,19,141,28,48,221,156,4,1,4,31,157,40,8,1050,101,25,2530,544,234,80,7,11,984,1408,154,3362,26,284,38,310,981,545,341,23,31,128,258,772,46,926,49,14,98,887,141,12,483,105,293,865,16,3221,283,30,502,234,10,121,169,1467,17,1,50,185,144,680,0,21,1,48,57,36,8,35,0,26,25,140,91,593,24,20,492,555,4,0,276,15,173,224,560,42,36,1000,20,30,207,2,139,1662,98,7,311,246,40,354,120,3,108,12,40,544,20,1,175,15,278,1148,582,0,184,214,232,310,9,10996,19,191,2810,220,364,95,24,62,179,6,65,1206,13,1,40,207,185,914,211,520,20796,35,0,6922,71,212,184,1225,379,83,39,287,65,73,113,10,962,10,0,1,62,7,37,79,10,228,3,30,83,3,3,3,85,5,48,69,119,41,23,78,31,34,12,113,34,6,3624,127,0,1553,41,7,139,69746,2678,53,5019,13,2,625,0,9,130,43,53,13,10,847,712,16,47,24,508,168,918,523,924,5,266,67,47,82,2,0,55,50,51,810,139,594,2358,1458,131,7,123,580,463,243,91,61,160,113,72,9,455,5,3,20,1055,482,179,250,197,25,377,204,5806,657,1477,158,212,490,87,152,51,126,203,2,1,16,160,11,2,82,0,92,81,74,51,235,1983,160,2321,4,0,21,83,70,8,20,2,893,81,52,128,229,267,24,5,3,80,284,1,586,97,12,134,97,38,3122,1,16,6,37,270,1445,179,12,153,269,3,14,790,447,75,1,2708,6,35,17,85,342,1153,11,1,54,1349,286,18,220,58,243,18,363,30,74,135,181,165,1,815,104,16,1150,63,0,64,13,341,5,152,44,842,60,5,11,67,27,113,1474,33,262,539,419,7,178,2193,96,176,143,19,401,810,179,1315,11,21,61,601,364,22,274,1151,55,45,100,23,225,62,13,3505,434,344,4,34,767,86,24,60,2,105,1344,331,15,12,481,2,297,3498,1065,75,28,40544,629,499,110,156,341,6,9,66,106,1,41,6,455,737,947,27,160,26,107,33,76,4,209,3,47,449,0,147,48,55,5,785,146,76,2505,324,201,74,64,137,11,767,3,150,602,2244,292,44,258,1229,2069,482,2400,71,7,234,82,17,92,51,500,104,88,6,4,120,120,160,213,531,225,5150,436,94,17,7,94,11,37,259,70,52,92,75,64,19,712,1,292,144,28,1086,118,74,4,84,29,3,3,113,132,22,56,62,37,628,33,30,41,990,1,4701,202,3,76,8253,945,104,313,333,17,158,7,255,186,26,64,3199,1958,6,515,61,700,45,4,537,91,8,26,28,214,72,58,89,21,17,230,0,426,11,28,73,72,2,2,28,59,47,4,79,607,265,197,392,67,246,187,2,1664,13156,710,171,10,258,158,20,750,88,204,475,376,8,1,119,10,1649,113,41,3,155,5,25,327,21,692,21,24,721,31,25,18,121,223,60,37,4760,2854,66,262,32,27,638,1919,548,57,54,95,17,19,11,850,1581,14,67,10,338,218,45,425,89,182,0,50,10,582,847,222,168,87,267,1734,299,25,60,893,42,37,26,77,539,50,33,40,162,36492,311,124,50,46,5,223,20,27,102,2,313,132,153,783,45,28,422,7,17,858,951,10,8993,309,202,109,68,163,44,164,323,498,14,822,5,6,73,96,4,128,271,466,8,45,27,106,7,55,3347,1163,204,270,496,296,302,43,144,33,2,62,20,354,516,378,46438,25,72)
  sample3 = c(0,0,5,2,0,3,3,5,5,2,0,8,1,1,0,0,28,4,0,1,0,6,0,0,7,3,5,26,0,78,0,0,0,0,4,20,3,0,80,1,9,0,13,0,13,1,0,0,4,5,22,85,0,0,5,0,4,1,30,0,0,0,0,0,0,0,0,0,3,1,43,0,12,1,0,3,0,15,8,22,8,0,1,1,0,0,0,1,5,0,3,0,23064,9366,0,5,0,4,0,0,71238,0,11177,0,7,0,0,247,150,99,3,12,284,10,168,12,136,0,144,2349,577,1,137,48,3,308,157,89,180,40,986,109,2714,91,0,2,1463,2,35,14,179,1,428,204,0,5,2,417,134,47,185,2347,0,46,0,19,5633,467,22,178,2,59,129,292,22,622,118,2,6,738,144,341,106,1,0,669,861,0,589,3035,1621,927,121,461,155,48,50,15704,910,23,26,271,1,4,2,593,0,53,25,389,1385,465,1301,495,0,1,446,720,0,15,38,6,780,1,54,407,46,382,158,806,286,18,84,416,118,82,0,4,3,597,169,1,386,2,149,2415,660,72,688,2,29,11061,123,58,1611,707,582,70,323,19,105,6,29,205,126,0,2,4,48,74,1,2,1283,126,22,1056,1068,167,84,0,1,1131,1229,125,8505,5,617,18,656,727,909,356,14,20,18,345,1523,30,813,1,1,22,997,97,10,457,4,32,678,2,1788,418,0,742,119,6,30,55,1557,13,2,42,339,17,829,0,44,1,32,12,5,10,4,1,47,22,126,3,931,34,18,321,257,6,0,222,14,96,387,867,21,16,778,55,126,205,13,128,261,66,1,262,43,70,606,122,1,105,5,7,296,5,2,344,1,556,1068,54,0,292,263,274,391,11,8281,3,416,3806,409,679,130,10,24,362,2,40,208,6,2,76,161,130,1718,175,668,27737,7,5,4057,239,48,95,2684,116,112,54,476,29,58,164,7,754,2,0,0,20,3,29,118,35,279,4,15,202,0,0,0,175,2,1,108,72,54,14,150,16,2,0,17,0,15,1875,135,1,631,76,4,370,43739,1769,27,4310,2,15,640,0,10,40,6,93,40,21,1433,415,10,11,39,165,175,266,444,1101,1,40,0,7,20,2,0,141,77,87,406,84,100,1190,2084,95,0,39,596,459,506,20,50,136,57,140,5,22,6,8,65,1111,739,67,128,257,19,624,236,3201,778,2317,103,12,5,154,173,96,211,131,3,0,16,175,26,35,122,0,90,61,49,66,187,2976,157,2588,3,0,1,53,0,0,18,0,1110,12,21,197,374,30,36,9,1,39,128,0,531,109,1,85,28,7,2852,1,10,5,30,157,2965,30,10,172,238,1,19,1168,874,79,0,480,6,51,26,164,268,1254,22,0,103,1891,392,38,147,26,470,11,603,51,86,3,31,333,1,596,62,4,1184,98,0,137,5,744,0,25,4,405,8,12,8,67,16,189,3188,61,563,557,1099,8,77,2717,98,4,298,30,994,798,143,903,11,18,19,865,343,45,382,222,151,4,266,4,214,22,6,6249,630,492,2,11,1776,194,5,198,0,95,394,559,7,0,114,5,389,2851,864,62,54,15118,371,1002,183,547,296,6,1,210,366,1,32,0,1009,2196,418,59,6,38,280,4,133,1,66,1,26,16,0,41,35,133,14,416,261,94,4760,343,8,167,85,62,0,101,0,45,141,4819,359,90,84,1944,1721,124,5170,71,4,35,46,22,98,4,74,172,148,20,3,2,286,32,163,785,324,3695,471,200,40,12,218,0,29,304,2,70,214,7,0,0,85,7,688,282,21,471,41,225,1,137,26,0,0,264,79,9,9,111,32,205,11,6,11,761,2,4471,97,0,91,1005,1422,17,218,178,16,177,1,113,345,3,75,1500,1126,12,720,249,104,57,2,460,68,20,86,45,8,26,31,71,24,2,143,4,725,0,2,114,136,1,0,21,9,11,5,60,228,193,77,851,63,75,194,19,2325,2330,184,156,8,6,30,4,568,76,472,33,426,0,1,178,6,1095,58,24,3,286,2,17,249,8,1007,23,4,538,34,94,6,159,103,8,95,3730,1851,15,368,45,17,828,1175,60,18,141,113,1,0,0,767,110,3,82,6,52,440,11,954,69,372,1,87,8,1370,1670,22,120,4,339,1287,673,14,14,799,21,14,8,7,502,13,40,44,28,7109,477,68,104,54,0,49,37,21,173,1,155,89,91,489,6,20,18,0,22,339,1238,1,9609,161,571,323,81,118,144,120,361,1101,0,199,0,3,103,6,1,133,108,45,2,2,2,82,5,26,2814,786,326,142,160,0,55,4,46,2,0,49,33,204,330,430,16375,0,176)
  sample4 = c(0,0,22,5,0,1,18,8,6,4,0,5,1,0,0,6,9,0,1,6,0,0,0,2,1,11,24,12,3,68,0,0,0,3,0,10,0,0,71,0,0,0,23,1,9,1,2,0,3,10,34,14,0,0,6,5,7,2,160,0,0,0,2,2,0,0,0,0,2,0,14,1,6,0,1,2,0,5,5,9,4,0,9,3,0,1,1,0,73,2,0,0,41213,3033,3,9,0,0,0,0,49631,0,3434,0,29,0,1,135,359,344,82,58,542,2,354,3,975,51,71,1061,253,22,849,96,61,1279,108,251,1506,96,760,97,159,102,22,181,26830,64,82,99,1517,5,758,460,149,34,8,449,180,90,2371,3798,73,133,36,1361,5176,172,133,231,65,71,195,164,198,221,740,40,387,466,351,1679,112,65,6,704,425,0,509,49196,529,1006,166,219,146,241,1681,7247,3224,240,75,454,78,274,260,4217,128,57,291,286,92,1172,18,184,357,13,1961,1296,83,200,232,39,1101,46,870,750,749,129,3099,1671,1279,145,591,1852,153,446,38,965,16,4930,135,2,644,58,473,4872,538,274,1526,101,228,4715,495,10376,587,1337,3067,527,666,80,102,15,116,2048,768,8,40,0,121,605,199,24,233,104,71,2284,903,726,377,8,122,2877,5886,59,3581,32,777,110,472,1775,545,684,91,125,21,138,210,114,492,20,7,7,401,320,48,388,78,565,2224,553,621,153,10,735,1557,54,261,2387,1757,79,9,453,574,100,553,2,37,23,76,549,239,3,53,40,273,14,225,139,1426,281,191,1815,1749,24,32,64,33,489,839,681,148,315,6934,27,126,548,83,589,809,89,4,132,217,42,350,303,6,1125,48,98,388,84,20,212,23,327,360,178,0,262,111,1096,128,66,8363,41,319,595,514,5000,49,50,62,232,3,74,5138,11,12,162,723,57,1756,238,420,5894,124,27,2300,926,477,123,687,409,61,158,594,206,143,39,17,109,68,6,9,193,28,80,555,58,93,45,76,176,2,2,19,213,88,2,128,211,167,151,191,176,81,154,526,1,11,3383,591,98,804,7,85,35,98868,287,111,1799,21,81,18,0,21,426,43,93,412,25,291,319,44,211,173,2671,53,638,233,526,8,905,38,126,162,28,64,174,133,176,162,745,3200,843,1833,550,31,425,369,495,250,91,644,194,134,66,17,787,29,263,103,88,1811,9,2511,120,42,1941,511,1226,2634,2355,581,772,1097,66,584,1272,200,7,1,62,90,397,40,42,297,10,341,435,2,1226,763,27837,192,798,25,0,714,357,90,61,339,0,16083,741,295,350,455,20,69,8,255,302,1293,2,375,27,6,372,195,197,8329,13,101,9,158,94,864,370,136,613,249,2,229,1104,185,404,0,514,38,38,43,55,555,352,13,14,87,1275,282,198,1308,75,1381,18,1392,65,297,344,929,737,10,2028,257,232,187,473,249,82,47,1339,20,1367,36,2129,63,24,65,390,102,237,2687,54,504,198,1723,126,144,6358,140,145,297,15,625,461,243,4494,370,34,571,166,124,145,701,639,168,52,193,21,254,298,16,8818,3382,1724,35,681,605,246,56,174,20,716,618,943,88,29,569,0,1866,607,252,83,45,312361,605,377,176,719,594,152,37,416,340,85,72,1,315,373,2248,251,272,547,138,229,88,97,309,36,219,49,1,299,295,322,29,75,182,242,3821,1174,128,1110,297,636,91,1674,11,228,1273,41,324,32,268,160,5797,619,1403,167,167,1979,40,52,418,30,294,56,26,135,69,293,410,92,720,172,255,8415,46,150,71,22,180,96,548,235,146,128,242,15,41,196,1744,32,122,751,8,703,1136,104,23,108,85,3,26,292,157,86,312,150,115,1656,245,51,30,2690,27,216,91,188,108,30514,953,269,625,951,37,235,12,141,412,23,42,1328,515,40,353,175,265,243,8,283,765,19,48,99,123,56,244,366,288,28,101,63,555,157,7,112,197,95,41,434,12,178,5,136,107,613,199,1397,118,286,830,9,204,5752,3284,508,48,106,52,8,891,228,457,1053,35,101,46,277,164,672,175,99,3,184,79,141,887,243,1421,77,22,1550,19,72,132,319,55,74,3,672,331,234,1038,855,23,2777,442,1457,154,213,247,74,74,107,497,3882,137,397,32,131,428,378,1484,187,886,21,113,146,38,905,278,319,72,340,5289,969,19,371,1230,178,12,54,12,279,25,36,16,7,96429,157,945,141,165,29,526,383,356,732,28,451,353,205,5064,141,166,130,12,430,11603,484,15,338,259,333,197,133,446,158,62,188,491,90,110,33,41,34,425,10,239,99,9,219,3,350,224,24,318,6760,974,212,721,817,312,110,324,317,309,7,138,88,4,559,1744,900,33,213)
  sample5 = c(0,0,24,3,0,2,12,1,3,5,0,5,3,1,0,7,6,0,1,9,0,2,0,0,2,9,31,15,10,22,0,0,0,0,4,7,0,0,52,0,4,0,6,1,4,0,0,0,6,1,36,11,0,0,4,0,4,0,153,0,0,0,1,0,0,0,0,0,2,0,9,1,7,0,0,1,0,6,1,9,1,0,15,4,0,0,0,0,62,2,1,0,21119,800,1,4,0,2,0,0,19807,0,913,0,22,0,0,180,207,413,29,39,445,6,254,16,819,46,58,1196,118,23,525,64,33,744,96,389,906,70,442,65,148,129,6,161,14016,109,75,39,1316,2,478,242,168,48,2,650,211,57,857,1825,62,82,20,1197,4830,162,56,138,51,43,104,158,136,134,607,21,171,246,216,731,78,57,2,549,365,0,259,21088,437,722,162,322,86,274,388,5268,1466,125,52,292,60,267,170,2471,121,57,222,200,42,613,56,93,141,13,887,834,44,223,148,90,804,22,379,336,884,139,1742,1697,656,149,257,1007,134,411,52,756,22,2112,75,7,464,31,325,4271,583,237,767,103,120,5175,230,9174,290,1824,3572,309,551,68,35,20,116,908,439,17,18,0,78,376,100,69,210,98,43,2065,587,476,304,11,77,1619,3698,73,3564,30,445,67,253,1135,328,365,34,58,15,274,260,74,660,45,16,42,241,191,13,316,109,402,1178,239,539,150,6,584,735,24,295,1552,1439,51,1,215,329,128,421,2,21,5,28,198,87,2,45,18,140,5,158,172,1107,240,53,1803,1294,9,3,49,29,274,690,400,70,105,4287,26,25,367,14,330,788,67,5,206,521,18,240,120,3,846,41,56,470,37,1,112,15,220,367,144,1,283,95,724,85,27,7277,39,177,529,247,3203,35,41,60,173,15,74,3567,11,7,114,283,32,1211,92,174,5189,121,18,1989,480,430,116,359,482,42,97,390,108,137,6,24,103,42,5,1,151,18,95,427,16,106,36,42,115,0,1,18,150,57,5,128,109,72,160,129,84,110,79,241,4,2,3250,652,18,397,5,42,50,55240,204,130,819,38,30,22,0,16,550,93,52,262,29,174,260,53,238,94,1084,27,324,202,754,10,646,50,107,205,16,28,113,55,119,166,439,1862,667,1754,401,22,386,512,256,195,116,554,115,132,61,15,849,13,167,57,102,1751,15,643,90,40,1006,291,680,1268,1729,502,718,1034,39,401,368,118,5,1,29,22,351,32,19,230,5,216,222,30,767,549,12676,98,820,15,0,320,109,116,32,314,2,3325,530,85,246,445,73,13,5,115,257,646,5,196,70,12,282,310,143,4870,17,60,22,148,63,800,223,80,387,275,5,290,624,139,169,0,494,10,29,29,106,353,213,38,14,66,598,500,98,854,70,1352,13,711,26,151,225,462,235,1,1255,232,130,184,208,123,71,39,751,21,864,50,1364,66,26,34,211,58,156,1686,47,245,101,972,42,97,3365,108,152,171,13,473,451,185,2792,153,13,365,123,77,56,342,305,108,39,81,23,353,165,21,3919,943,691,5,196,559,87,29,149,19,541,1155,393,39,35,776,0,1191,273,109,45,60,174532,649,243,171,499,461,79,33,250,271,34,56,1,173,308,2294,168,218,174,76,101,55,50,184,10,118,59,2,249,165,193,8,165,117,128,2567,484,173,464,162,685,63,667,0,180,639,58,234,32,483,167,4367,519,864,138,84,1749,25,45,243,53,484,73,27,73,39,326,446,74,520,231,239,6136,91,140,47,23,199,58,294,121,143,106,152,11,49,175,1230,6,82,444,21,863,649,75,41,117,77,4,21,149,405,52,192,102,66,1708,63,32,40,1890,22,83,122,137,102,29637,1359,214,318,435,43,138,6,282,266,22,37,776,280,30,440,110,318,172,1,233,338,11,61,82,136,53,159,263,171,37,109,15,468,79,7,86,149,23,21,210,24,120,5,112,123,304,131,936,103,521,490,9,156,3475,2175,497,45,230,48,44,1073,144,239,1061,37,34,30,167,60,421,202,33,2,140,48,83,570,150,926,27,24,663,14,60,37,186,116,70,3,253,338,83,466,309,3,1683,446,900,81,158,135,41,69,87,595,2976,96,208,40,215,330,249,928,96,433,15,51,74,227,604,201,226,102,154,2524,670,47,460,837,88,24,48,15,190,44,14,9,22,67426,102,463,68,187,24,436,121,169,388,16,357,231,156,2384,115,92,113,22,227,4575,363,27,226,95,287,119,78,310,115,75,157,270,42,30,35,49,17,218,8,718,291,33,152,4,209,94,13,181,4706,881,155,548,364,233,65,105,233,366,4,207,65,24,507,1076,754,47,189)
  sample6 = c(0,0,30,4,0,0,18,9,1,18,1,16,6,2,0,7,43,2,1,17,0,3,0,1,6,15,9,37,2,27,0,3,0,0,2,28,1,2,209,0,23,0,11,3,34,0,0,0,9,9,70,45,0,0,10,0,7,1,142,0,0,0,1,0,0,0,0,0,4,1,36,0,33,1,0,2,0,38,7,23,29,0,2,8,0,0,0,0,99,1,22,0,62351,2921,3,14,0,8,0,0,69911,0,3409,0,36,0,0,209,185,289,5,24,347,96,762,6,842,75,52,2107,327,3,472,65,36,742,78,1306,783,89,738,75,816,142,1,140,12399,181,71,82,1141,2,744,271,66,57,4,1127,239,60,1201,2468,65,97,22,1392,5699,164,35,74,99,56,138,183,42,135,364,33,19,466,420,1132,83,95,1,1300,624,0,207,19379,2720,1126,222,432,59,257,523,7175,1466,127,25,268,61,212,313,3459,134,36,143,265,372,829,409,357,4,9,1085,958,58,222,88,74,1019,6,598,1164,2126,450,1512,2386,441,196,245,674,68,575,46,519,16,2108,361,6,720,57,556,4883,628,181,699,45,54,10043,163,5401,561,2314,6980,169,620,77,134,26,104,650,382,14,9,0,28,468,112,12,785,77,27,4118,837,333,340,24,69,2178,4841,208,5994,17,202,48,324,1909,374,472,14,62,81,343,749,71,1004,78,13,17,1614,285,9,255,127,832,1061,105,3338,256,47,704,1043,8,308,1136,2117,33,5,70,212,139,213,9,31,2,41,292,63,2,47,22,64,13,149,179,1094,62,14,2114,996,5,0,67,19,255,723,741,42,57,2886,21,43,456,7,227,2836,33,2,214,525,15,475,171,5,416,19,87,821,20,1,113,32,252,866,999,0,350,102,530,64,9,20688,34,202,1322,301,1352,57,39,68,147,19,78,2833,29,6,31,261,44,1741,152,160,18060,98,3,6549,165,345,458,620,784,83,140,522,133,83,24,18,66,31,1,2,219,10,128,683,42,112,37,41,118,0,0,6,161,12,5,54,237,57,128,169,115,153,34,232,14,2,5509,860,0,1896,10,31,318,72628,1842,150,2864,29,12,33,0,20,545,54,44,44,15,694,290,38,133,68,2388,72,191,201,1538,17,497,95,157,151,10,1,74,53,150,376,457,1831,2730,2846,329,24,349,949,183,302,179,165,104,212,28,8,314,6,106,61,395,1283,168,405,161,33,1255,346,1936,1590,2324,395,971,1444,74,278,70,88,64,0,3,11,386,33,19,184,3,177,348,111,1126,585,4641,78,1432,11,0,182,181,124,38,182,2,2991,328,80,388,411,282,36,7,37,109,1045,1,242,66,7,454,184,72,7963,11,70,15,121,35,1790,192,25,320,429,2,80,1462,350,163,0,2895,1,41,34,162,546,1332,29,7,82,1009,946,70,1186,135,1091,14,797,12,162,295,786,256,2,1350,272,54,810,104,12,89,51,772,36,653,141,1566,89,20,13,203,28,146,2230,58,197,1035,1152,20,332,5039,229,292,168,5,661,531,419,3457,21,16,369,301,147,54,314,929,76,50,190,66,548,144,22,4541,951,557,1,234,996,90,49,83,9,336,2287,440,44,29,1652,1,612,1186,300,41,52,70624,1783,586,204,427,622,11,12,195,275,1,60,2,1092,572,2414,70,238,82,168,71,84,15,307,18,70,506,3,298,171,155,8,575,206,163,3927,1680,325,104,123,272,38,1087,1,522,907,59,105,32,601,616,5865,1381,1590,193,19,849,15,59,163,114,1036,54,64,21,12,184,334,215,503,973,302,8728,654,136,9,5,205,24,70,141,172,202,112,85,160,29,2034,12,338,264,79,1823,848,71,28,99,47,4,9,169,422,44,202,162,63,926,40,39,113,2451,5,163,201,43,102,16639,1920,201,386,615,16,250,3,427,192,26,51,1082,978,21,1459,98,1450,86,3,273,394,27,52,39,294,104,79,290,91,26,180,0,514,97,26,61,94,16,2,69,36,115,7,110,718,333,311,689,126,414,517,17,833,6516,3748,455,12,570,234,103,1445,185,168,1708,283,17,6,90,115,372,322,38,9,195,34,81,541,73,1524,17,32,2473,27,53,4,144,451,55,7,2209,965,105,396,327,23,1741,2228,1587,47,165,205,32,30,56,1268,3067,52,66,35,713,495,304,1333,94,631,4,93,36,1838,1501,298,199,133,145,3962,662,50,293,632,37,16,62,26,997,72,13,4,184,59102,157,434,117,125,21,552,37,124,245,9,378,246,178,2238,108,81,381,30,111,2046,677,15,2243,463,215,174,106,543,105,154,351,391,30,31,13,25,28,326,16,591,255,339,30,14,189,77,20,102,5766,2046,164,737,1450,700,108,179,189,364,2,72,148,563,1547,397,4952,22,124)

  table = cbind(names, sample1, sample2, sample3, sample4, sample5, sample6)
  colnames(table)=c("Transcrit", "Control R1", "Control R2", "Control R3", "Condition1 R1", "Condition1 R2", "Condition1 R3")
  rownames(table)=NULL
  return(table)
}

getReplicaNames<- function(input){

  replicaName = c()
  cpt = 1

  for( i in 1:input$nb_facteur) {
    for( j in 1: length(input[[paste0('file', i)]][[1]])) {
      replicaName[cpt] = paste0( input[[paste0('condition',i)]],' R', j)
      cpt = cpt+1
    }
  }
  return(replicaName)
}

goFilter <- function(x, level) {


  ID <- NULL ## to satisfy codetools for using ID in subset function

  ont <- x@setType

  terms <- getGOLevel(ont, level)


  x@result %<>% subset(ID %in% terms)

  return(x)
}

getGOLevel <-function (onto, level){
  {
    GOChildren <- function (ontoTab, terms) {
      children <- ontoTab[ontoTab[,2] %in% terms,1]
    }

    if (!((onto == "MF") || (onto == "BP") || (onto == "CC"))) {
      on.exit(cat("You must enter MF, BP or CC as ontology"))
      GOLevel <- NULL
    }
    else {
      switch(onto, MF = {
        topNode <- "GO:0003674"
        chTab<-toTable(GOMFCHILDREN)
      }, BP = {
        topNode <- "GO:0008150"
        chTab<-toTable(GOBPCHILDREN)
      }, CC = {
        topNode <- "GO:0005575"
        chTab<-toTable(GOCCCHILDREN)
      })

      GOLevel <- topNode
      if (level < 1) {
        on.exit(cat("You must enter a level greater than 1"))
        GOLevel <- NULL
      }
      else {
        if (level==1) {
          GOLevel <- topNode
        }
        else{
          GOLevel<-topNode
          for (i in (1:(level - 1))){
            # childLevel <- chTab[chTab[,2] %in% GOLevel,1]
            childLevel <- GOChildren(chTab, GOLevel)
            GOLevel <- childLevel
            # GOLevel <- GOLevel[!is.na(GOLevel)] # No se si cal?
          }
        }
      }

      return(unique(GOLevel))
    }
  }
}
barplot<- function(height, x="Count", color='p.adjust',
                   showCategory=8, font.size=12, title="",
                   label_format=30, ...) {
  ## use *height* to satisy barplot generic definition
  ## actually here is an enrichResult object.
  object <- height

  colorBy <- match.arg(color, c("pvalue", "p.adjust", "qvalue"))
  if (x == "geneRatio" || x == "GeneRatio") {
    x <- "GeneRatio"
  }
  else if (x == "count" || x == "Count") {
    x <- "Count"
  }

  df <- fortify(object, showCategory=showCategory, by=x, ...)

  if(colorBy %in% colnames(df)) {
    p <- ggplot(df, aes_string(x = x, y = "Description", fill = colorBy)) +
      theme_dose(font.size) +
      scale_fill_continuous(low="red", high="blue", name = color,
                            guide=guide_colorbar(reverse=TRUE))
  } else {
    p <- ggplot(df, aes_string(x = x, y = "Description",
                               fill = "Description")) +
      theme_dose(font.size) +
      theme(legend.position="none")
  }

  label_func <- default_labeller(label_format)
  if(is.function(label_format)) {
    label_func <- label_format
  }

  p + geom_col() + # geom_bar(stat = "identity") + coord_flip() +
    scale_y_discrete(labels = label_func) +
    ggtitle(title) + ylab(NULL) # + xlab(NULL)
}

default_labeller <- function(n) {
  function(str){
    str <- gsub("_", " ", str)
    ep_str_wrap(str, n)
  }
}
ep_str_wrap <- function(string, width) {
  x <- gregexpr(' ', string)
  vapply(seq_along(x),
         FUN = function(i) {
           y <- x[[i]]
           n <- nchar(string[i])
           len <- (c(y,n) - c(0, y)) ## length + 1
           idx <- len > width
           j <- which(!idx)
           if (length(j) && max(j) == length(len)) {
             j <- j[-length(j)]
           }
           if (length(j)) {
             idx[j] <- len[j] + len[j+1] > width
           }
           idx <- idx[-length(idx)] ## length - 1
           start <- c(1, y[idx] + 1)
           end <- c(y[idx] - 1, n)
           words <- substring(string[i], start, end)
           paste0(words, collapse="\n")
         },
         FUN.VALUE = character(1)
  )
}



#' Typing reactiveValues is too long
#'
#' @inheritParams reactiveValues
#' @inheritParams reactiveValuesToList
#'
#' @noRd
rv <- function(...) shiny::reactiveValues(...)
rvtl <- function(...) shiny::reactiveValuesToList(...)
